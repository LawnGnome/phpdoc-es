<?xml version="1.0" encoding="iso-8859-1"?>
<!-- $Revision: 1.9 $ -->
<!-- EN-Revision: 1.22 Maintainer: rafael Status: ready -->

 <chapter id="features.http-auth">
  <title>Autentificaci&oacute;n HTTP con PHP</title>

  <simpara>
   Las caracter&iacute;ticas de autentificaci&oacute;n HTTP en PHP solo estan
   disponibles cuando se est&aacute; ejecutando como un m&oacute;dulo en Apache y
   hasta ahora no lo estan en la versi&oacute;n CGI. En un script PHP como
   m&oacute;dulo de Apache, se puede usar la funci&oacute;n
   <function>header</function> para enviar un mensaje de
   "Autentificaci&oacute;n requerida" al navegador cliente haciendo que
   muestre una ventana de entrada emergente con nombre de usuario y
   contrase&ntilde;a. Una vez que el usuario ha rellenado el nombre y la
   contrase&ntilde;a, la URL que contiene el script PHP vuelve a ser llamada
   con las variables $PHP_AUTH_USER, $PHP_AUTH_PW y $PHP_AUTH_TYPE
   rellenas con el nombre de usuario, la contrase&ntilde;a y el tipo de
   autentificaci&oacute;n respectivamente. S&oacute;lo autentificaci&oacute;n "B&aacute;sica"
   esta soportada en este momento. Consulte la funci&oacute;n 
   <function>header</function> para m&aacute;s informaci&oacute;n.</simpara>

  <para>
   Un fragmento de script de ejmplo que fuerce la autentificaci&oacute;n del
   cliente en una p&aacute;gina ser&iacute;a como el siguiente:
    <example>
    <title>Ejemplo de autentificaci&oacute;n HTTP</title>
   <programlisting role="php">
<![CDATA[
<?php
  if (!isset($PHP_AUTH_USER)) {
    header("WWW-Authenticate: Basic realm=\"My Realm\"");
    header("HTTP/1.0 401 Unauthorized");
    echo "Text to send if user hits Cancel button\n";
    exit;
  } else {
    echo "<p>Hello $PHP_AUTH_USER.</p>";
    echo "<p>You entered $PHP_AUTH_PW as your password.</p>";
  }
?>
]]>
    </programlisting>
   </example></para>

  <note>
   <title>Nota</title>
   <para>
    Por favor tener cuidado cuando esteis programando las lines de cabecera HTTP.
    Para garantizar la maxima compatibilidad con todos los clientes, la palabra
    clave &quot;Basic&quot; debe de ser escrita con &quot;B&quot; may&uacute;scula, la cadena
    de texto debe estar incluida entre comillas dobles (no simples) y un espacio debe
    preceder el c&oacute;digo &quot;401&quot; en la linea de cabecera &quot;HTTP/1.0 401&quot;
   </para>
  </note>
  <para>
   En vez de, sencillamente, mostrar $PHP_AUTH_USER y
   $PHP_AUTH_PW, seguramente querais comprobar la validez del nombre
   de usuario y la contrase&ntilde;a. Tal vez enviando una consulta a una
   base de datos o buscando el usuario en un fichero dbm.
  </para>

  <para>
   Vigilar aqu&iacute; los navegadores Interner Explorer con bugs. Parecen muy
   quisquillosos con el orden de las cabeceras. Enviar la cabecera
   <emphasis>WWW-Autentificaci&oacute;n</emphasis> antes que la cabecera   
   <errorcode>HTTP/1.0 401</errorcode> parece ser el truco por ahora.</para>

  <simpara>
   Para prevenir que alguien escriba un script que revele la
   contrase&ntilde;a de una p&aacute;gina que ha sido autentificada a trav&eacute;s de
   alg&uacute;n mecanismo externo tradicional, las variables PHP_AUTH no
   ser&aacute;n rellenadas si alg&uacute;n tipo de autentificaci&oacute;n externo ha sido
   activado para una p&aacute;gina en particular. En este caso, la variable 
   $REMOTE_USER puede ser usada para identificar al usuario
   autentificado externamente.
   </simpara>

  <note>
   <title>Configuration Note</title>
   <para>
    PHP usa la directiva <literal>AuthType</literal> para determinar 
    si una autentificaci&oacute;n externa esta en uso. Recordar no usar esta
    directiva cuando querais usar la autentificaci&oacute;n de PHP (si no
    todo intentento de autentificaci&oacute;n fallar&aacute;)
   </para>
  </note>

  <simpara>
   Nota, a pesar de todo, lo ya dicho no proteje de que alguien que
   controle una URL no autentificada robe contrase&ntilde;as de URLs
   autentificadas en el mismo servidor.
  </simpara>
  
  <simpara>
   Tanto Netscape como Internet Explorer borrar&aacute;n la cach&eacute; de la
   ventana de autentificaci&oacute;n en el navegador local despu&eacute;s de
   recibir una respuesta 401 del servidor. Esto puede usarse, de
   forma efectiva, para "desconectar" a un usuario, forzandole a
   reintroducir su nombre y contrase&ntilde;a. Algunas personas usan esto
   para &quot;hacer caducar&quot; entradas, o para proveer un bot&oacute;n de
   "desconectar".</simpara>

  <simpara></simpara>
   <example>
     <title>Ejemplo de autentificaci&oacute;n HTTP forzando una
     reentrada</title>   
  <programlisting role="php">
<![CDATA[
<?php
  function authenticate() {
    header( "WWW-Authenticate: Basic realm=\"Test Authentication System\"");
    header( "HTTP/1.0 401 Unauthorized");
    echo "You must enter a valid login ID and password to access this resource\n";
    exit;
  }
 
  if (!isset($PHP_AUTH_USER) || ($SeenBefore == 1 && !strcmp($OldAuth, $PHP_AUTH_USER))) {
   authenticate();
  } 
  else {
   echo "<p>Welcome: $PHP_AUTH_USER<br>";
   echo "Old: $OldAuth";
   echo "<form action='$PHP_SELF' METHOD='POST'>\n";
   echo "<input type='hidden' name='SeenBefore' value='1'>\n";
   echo "<input type='hidden' name='OldAuth' value='$PHP_AUTH_USER'>\n";
   echo "<input type='submit' value='Re Authenticate'>\n";
   echo "</form></p>\n";
  }
?>
]]>
   </programlisting>
  </example>
  
  <simpara>
   Este comportamiento no es requerido por el est&aacute;ndar de autentificaci&oacute;n
   b&aacute;sica de HTTP, por lo que nunca debe depender de esto. Pruebas
   con Lynx han demostrado que Lynx no borra las credenciales de 
   autentificaci&oacute;n con una respuesta 401 del servidor, por lo que
   pulsando atr&aacute;s y despu&eacute;s adelante abrir&iacute;a el recurso de nuevo 
   (siempre que los requerimientos de contrase&ntilde;a no hayan cambiado). 
  </simpara>
  <simpara>
   Adem&aacute;s tener en cuanta que esto no funciona usando el servidor IIS de Microsoft
   y la versi&oacute;n CGI de PHP debido a una limitaci&oacute;n del IIS
  </simpara>

 </chapter>

<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-omittag:t
sgml-shorttag:t
sgml-minimize-attributes:nil
sgml-always-quote-attributes:t
sgml-indent-step:1
sgml-indent-data:t
indent-tabs-mode:nil
sgml-parent-document:nil
sgml-default-dtd-file:"../manual.ced"
sgml-exposed-tags:nil
sgml-local-catalogs:nil
sgml-local-ecat-files:nil
End:
vim600: syn=xml fen fdm=syntax fdl=2 si
vim: et tw=78 syn=sgml
vi: ts=1 sw=1
-->
