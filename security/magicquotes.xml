<?xml version="1.0" encoding="utf-8"?>
<!-- $Revision: 1.3 $ -->
<!-- EN-Revision: 1.8 Maintainer: lboshell Status: ready -->
  <chapter id="security.magicquotes">
   <title>Comillas Mágicas</title>

   <para>
    Las comillas mágicas (o "Magic Quotes") se refieren a un proceso
    que automáticamente escapa datos de entrada en los scripts de
    PHP. Es recomendable escribir código con las comillas mágicas
    deshabilitadas, y en su lugar escapar los datos en tiempo de
    ejecución, a medida que se necesite.
   </para>

   <sect1 id="security.magicquotes.what">
    <title>Qué Son Las Comillas Mágicas</title>
    <para>
     Cuando se habilitan, todos los caracteres <literal>'</literal>
     (comilla sencilla), <literal>"</literal> (comilla doble),
     <literal>\</literal> (barra invertida) y <literal>NULL</literal>
     se escapan con una barra invertida de forma automática. Esto es
     idéntico a lo que hace <function>addslashes</function>.
    </para>
    <para>
     Existen tres directivas de comillas mágicas:
    </para>
    <itemizedlist>
     <listitem>
      <simpara>
       <link linkend="ini.magic-quotes-gpc">magic_quotes_gpc</link>
      </simpara>
      <simpara>
       Afecta los datos de peticiones HTTP (GET, POST y COOKIE). No
       puede definirse en tiempo de ejecución, y su valor
       predeterminado es <emphasis>on</emphasis> en PHP.
      </simpara>
      <simpara>
       Vea también <function>get_magic_quotes_gpc</function>.
      </simpara>
     </listitem>
     <listitem>
      <simpara>
       <link linkend="ini.magic-quotes-runtime">magic_quotes_runtime</link>
      </simpara>
      <simpara>
       Si se habilita, la mayoría de funciones que devuelven datos de
       una fuente externa, incluyendo bases de datos y archivos de
       texto, escaparán las comillas con una barra invertida. Puede
       definirse en tiempo de ejecución, y su valor predeterminado en
       PHP es <emphasis>off</emphasis>.
      </simpara>
      <simpara>
       Vea también <function>set_magic_quotes_runtime</function> y
       <function>get_magic_quotes_runtime</function>.
      </simpara>
     </listitem>
     <listitem>
      <simpara>
       <link linkend="ini.magic-quotes-sybase">magic_quotes_sybase</link>
      </simpara>
      <simpara>
       Si se habilita, una comilla sencilla se escapa con una comilla
       sencilla en lugar de una barra invertida. Asimismo,
       sobreescribe completamente <link
       linkend="ini.magic-quotes-gpc">magic_quotes_gpc</link>.
       Habilitar ambas directivas quiere decir que sólo las comillas
       sencillas se escapan como <literal>''</literal>. Las comillas
       dobles, las barras invertidas y los NULL permanecerán intactos
       y sin escapar.
      </simpara>
      <simpara>
       Vea también <function>ini_get</function> para conocer su valor.
      </simpara>
     </listitem>
    </itemizedlist>
   </sect1>

   <sect1 id="security.magicquotes.why">
    <title>Porqué Usar Comillas Mágicas</title>
    <itemizedlist>
     <listitem>
      <simpara>
       Útil para principiantes
      </simpara>
      <simpara>
       Las comillas mágicas son implementadas en PHP para ayudar a que
       el código escrito por principiantes no resulte
       peligroso. Aunque la <link
       linkend="security.database.sql-injection">Inyección SQL</link>
       es posible aun con las comillas mágicas habilitadas, el riesgo
       es reducido.
      </simpara>
     </listitem>
     <listitem>
      <simpara>
       Conveniencia
      </simpara>
      <simpara>
       Para insertar datos en una base de datos, las comillas mágicas
       básicamente usan <function>addslashes</function> sobre todos
       los datos Get, Post, y Cookie, y lo hace automáticamente.
      </simpara>
     </listitem>
    </itemizedlist>
   </sect1>

   <sect1 id="security.magicquotes.whynot">
    <title>Porqué No Usar Comillas Mágicas</title>
    <itemizedlist>
     <listitem>
      <simpara>
       Portabilidad
      </simpara>
      <simpara>
       Asumir que estén habilitadas, o deshabilitadas, afecta la
       portabilidad. Use <function>get_magic_quotes_gpc</function>
       para verificar su valor, y escriba su código de forma acorde.
      </simpara>
     </listitem>
     <listitem>
      <simpara>
       Rendimiento
      </simpara>
      <simpara>
       Ya que no todo fragmento de datos escapados es insertado en una
       base de datos, existe una pérdida en rendimiento al escapar
       todos esos datos. Simplemente llamar las funciones de escape
       (como <function>addslashes</function>) en tiempo de ejecución
       es más eficiente.
      </simpara>
      <simpara>
       Aunque <filename>php.ini-dist</filename> habilita estas
       directivas por defecto,
       <filename>php.ini-recommended</filename> las deshabilita. Esta
       recomendación se hace principalmente por razones de
       rendimiento.
      </simpara>
     </listitem>
     <listitem>
      <simpara>
       Inconveniencia
      </simpara>
      <simpara>
       Ya que no todos los datos necesitan ser escapados, con
       frecuencia resulta molesto ver datos escapados cuando no
       debieran estarlo. Por ejemplo, enviar un correo electrónico
       desde un formulario y ver un montón de \' en el
       mensaje. Arreglar esto puedo requerir un uso exagerado de
       <function>stripslashes</function>.
      </simpara>
     </listitem>
    </itemizedlist>
   </sect1>

   <sect1 id="security.magicquotes.disabling">
    <title>Desactivación de Comillas Mágicas</title>
    <para>
     Puede que la directiva <link
     linkend="ini.magic-quotes-gpc">magic_quotes_gpc</link> solo pueda
     ser desactivada en el nivel de sistema, y no en tiempo de
     ejecución. En otras palabras, usar <function>ini_set</function>
     no es posible.
    </para>
    <para>
     <example>
      <title>Desactivación de comillas mágicas del lado del
      servidor</title>
      <para>
       Un ejemplo que define el valor de estas directivas a
       <literal>Off</literal> en &php.ini;. Para detalles adicionales,
       lea la sección del manual titulada <link
       linkend="configuration.changes">Cómo modificar los parámetros
       de configuración</link>.
      </para>
      <screen>
<![CDATA[
; Magic Quotes
;

; Comillas mágicas para datos GET/POST/Cookie de entrada.
magic_quotes_gpc = Off

; Comillas mágicas para datos generados en tiempo de ejecución,
; p.ej. desde SQL, exec(), etc
magic_quotes_runtime = Off

; Usar comillas mágicas tipo Sybase (escapar ' con '' en lugar de \').
magic_quotes_sybase = Off
]]>
      </screen>
      <para>
       Si el acceso a la configuración del servidor no se encuentra
       disponible, el uso de <filename>.htaccess</filename> es también
       una opción. Por ejemplo:
      </para>
      <screen>
<![CDATA[
php_flag magic_quotes_gpc Off
]]>
      </screen>
     </example>
    </para>
    <para>
     Con el propósito de escribir código portable (código que funciona
     en cualquier entorno), por ejemplo si la configuración en el
     nivel del servidor no es posible, he aquí un ejemplo de cómo
     deshabilitar <link
     linkend="ini.magic-quotes-gpc">magic_quotes_gpc</link> en tiempo
     de ejecución. Este método es ineficiente así que es preferible
     definir las directivas apropiadas en algún otro lugar.
    </para>
    <para>
     <example>
      <title>Deshabilitar comillas mágicas en tiempo de
      ejecución</title>
      <programlisting role="php">
<![CDATA[
<?php
if (get_magic_quotes_gpc()) {
    function stripslashes_profundo($valor)
    {
        $valor = is_array($valor) ?
                    array_map('stripslashes_profundo', $valor) :
                    stripslashes($valor);

        return $valor;
    }

    $_POST = array_map('stripslashes_profundo', $_POST);
    $_GET = array_map('stripslashes_profundo', $_GET);
    $_COOKIE = array_map('stripslashes_profundo', $_COOKIE);
    $_REQUEST = array_map('stripslashes_profundo', $_REQUEST);
}
?>
]]>
      </programlisting>
     </example>
    </para>
   </sect1>

  </chapter>

<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-omittag:t
sgml-shorttag:t
sgml-minimize-attributes:nil
sgml-always-quote-attributes:t
sgml-indent-step:1
sgml-indent-data:t
indent-tabs-mode:nil
sgml-parent-document:nil
sgml-default-dtd-file:"../../manual.ced"
sgml-exposed-tags:nil
sgml-local-catalogs:nil
sgml-local-ecat-files:nil
End:
vim600: syn=xml fen fdm=syntax fdl=2 si
vim: et tw=78 syn=sgml
vi: ts=1 sw=1
-->
