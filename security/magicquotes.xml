<?xml version="1.0" encoding="iso-8859-1"?>
<!-- $Revision: 1.2 $ -->
<!-- EN-Revision: 1.7 Maintainer: lboshell Status: ready -->
  <chapter id="security.magicquotes">
   <title>Comillas M&aacute;gicas</title>

   <para>
    Las comillas m&aacute;gicas (o "Magic Quotes") se refieren a un
    proceso que autom&aacute;ticamente escapa datos de entrada en los
    scripts de PHP. Es recomendable escribir c&oacute;digo con las
    comillas m&aacute;gicas deshabilitadas, y en su lugar escapar los
    datos en tiempo de ejecuci&oacute;n, a medida que se necesite.
   </para>

   <sect1 id="security.magicquotes.what">
    <title>Qu&eacute; Son Las Comillas M&aacute;gicas</title>
    <para>
     Cuando se habilitan, todos los caracteres <literal>'</literal>
     (comilla sencilla), <literal>"</literal> (comilla doble),
     <literal>\</literal> (barra invertida) y <literal>NULL</literal>
     se escapan con una barra invertida de forma
     autom&aacute;tica. Esto es id&eacute;ntico a lo que hace
     <function>addslashes</function>.
    </para>
    <para>
     Existen tres directivas de comillas m&aacute;gicas:
    </para>
    <itemizedlist>
     <listitem>
      <simpara>
       <link linkend="ini.magic-quotes-gpc">magic_quotes_gpc</link>
      </simpara>
      <simpara>
       Afecta los datos de peticiones HTTP (GET, POST y COOKIE). No
       puede definirse en tiempo de ejecuci&oacute;n, y su valor
       predeterminado es <emphasis>on</emphasis> en PHP.
      </simpara>
      <simpara>
       Vea tambi&eacute;n <function>get_magic_quotes_gpc</function>.
      </simpara>
     </listitem>
     <listitem>
      <simpara>
       <link linkend="ini.magic-quotes-runtime">magic_quotes_runtime</link>
      </simpara>
      <simpara>
       Si se habilita, la mayor&iacute;a de funciones que devuelven
       datos de una fuente externa, incluyendo bases de datos y
       archivos de texto, escapar&aacute;n las comillas con una barra
       invertida. Puede definirse en tiempo de ejecuci&oacute;n, y su
       valor predeterminado en PHP es <emphasis>off</emphasis>.
      </simpara>
      <simpara>
       Vea tambi&eacute;n
       <function>set_magic_quotes_runtime</function> y
       <function>get_magic_quotes_runtime</function>.
      </simpara>
     </listitem>
     <listitem>
      <simpara>
       <link linkend="ini.magic-quotes-sybase">magic_quotes_sybase</link>
      </simpara>
      <simpara>
       Si se habilita, una comilla sencilla se escapa con una comilla
       sencilla en lugar de una barra invertida. Asimismo,
       sobreescribe completamente <link
       linkend="ini.magic-quotes-gpc">magic_quotes_gpc</link>.
       Habilitar ambas directivas quiere decir que s&oacute;lo las
       comillas sencillas se escapan como <literal>''</literal>. Las
       comillas dobles, las barras invertidas y los NULL
       permanecer&aacute;n intactos y sin escapar.
      </simpara>
      <simpara>
       Vea tambi&eacute;n <function>ini_get</function> para conocer su
       valor.
      </simpara>
     </listitem>
    </itemizedlist>
   </sect1>

   <sect1 id="security.magicquotes.why">
    <title>Porqu&eacute; Usar Comillas M&aacute;gicas</title>
    <itemizedlist>
     <listitem>
      <simpara>
       &Uacute;til para principiantes
      </simpara>
      <simpara>
       Las comillas m&aacute;gicas son implementadas en PHP para
       ayudar a que el c&oacute;digo escrito por principiantes no
       resulte peligroso. Aunque la <link
       linkend="security.database.sql-injection">Inyecci&oacute;n
       SQL</link> es posible aun con las comillas m&aacute;gicas
       habilitadas, el riesgo es reducido.
      </simpara>
     </listitem>
     <listitem>
      <simpara>
       Conveniencia
      </simpara>
      <simpara>
       Para insertar datos en una base de datos, las comillas
       m&aacute;gicas b&aacute;sicamente usan
       <function>addslashes</function> sobre todos los datos Get,
       Post, y Cookie, y lo hace autom&aacute;ticamente.
      </simpara>
     </listitem>
    </itemizedlist>
   </sect1>

   <sect1 id="security.magicquotes.whynot">
    <title>Porqu&eacute; No Usar Comillas M&aacute;gicas</title>
    <itemizedlist>
     <listitem>
      <simpara>
       Portabilidad
      </simpara>
      <simpara>
       Asumir que est&eacute;n habilitadas, o deshabilitadas, afecta
       la portabilidad. Use <function>get_magic_quotes_gpc</function>
       para verificar su valor, y escriba su c&oacute;digo de forma
       acorde.
      </simpara>
     </listitem>
     <listitem>
      <simpara>
       Rendimiento
      </simpara>
      <simpara>
       Ya que no todo fragmento de datos escapados es insertado en una
       base de datos, existe una p&eacute;rdida en rendimiento al
       escapar todos esos datos. Simplemente llamar las funciones de
       escape (como <function>addslashes</function>) en tiempo de
       ejecuci&oacute;n es m&aacute;s eficiente.
      </simpara>
      <simpara>
       Aunque <filename>php.ini-dist</filename> habilita estas
       directivas por defecto,
       <filename>php.ini-recommended</filename> las deshabilita. Esta
       recomendaci&oacute;n se hace principalmente por razones de
       rendimiento.
      </simpara>
     </listitem>
     <listitem>
      <simpara>
       Inconveniencia
      </simpara>
      <simpara>
       Ya que no todos los datos necesitan ser escapados, con
       frecuencia resulta molesto ver datos escapados cuando no
       debieran estarlo. Por ejemplo, enviar un correo
       electr&oacute;nico desde un formulario y ver un mont&oacute;n
       de \' en el mensaje. Arreglar esto puedo requerir un uso
       exagerado de <function>stripslashes</function>.
      </simpara>
     </listitem>
    </itemizedlist>
   </sect1>

   <sect1 id="security.magicquotes.disabling">
    <title>Desactivaci&oacute;n de Comillas M&aacute;gicas</title>
    <para>
     Puede que la directiva <link
     linkend="ini.magic-quotes-gpc">magic_quotes_gpc</link> solo pueda
     ser desactivada en el nivel de sistema, y no en tiempo de
     ejecuci&oacute;n. En otras palabras, usar
     <function>ini_set</function> no es posible.
    </para>
    <para>
     <example>
      <title>Desactivaci&oacute;n de comillas m&aacute;gicas del lado
      del servidor</title>
      <para>
       Un ejemplo que define el valor de estas directivas a
       <literal>Off</literal> en &php.ini;. Para detalles adicionales,
       lea la secci&oacute;n del manual titulada <link
       linkend="configuration.changes">C&oacute;mo modificar los
       par&aacute;metros de configuraci&oacute;n</link>.
      </para>
      <screen>
<![CDATA[
; Comillas magicas
;

; Comillas magicas para datos GET/POST/Cookie de entrada.
magic_quotes_gpc = Off

; Comillas magicas para datos generados en tiempo de ejecucion,
; p.ej. desde SQL, exec(), etc
magic_quotes_runtime = Off

; Usar comillas magicas tipo Sybase (escapar ' con '' en lugar de \').
magic_quotes_sybase = Off
]]>
      </screen>
      <para>
       Si el acceso a la configuraci&oacute;n del servidor no se
       encuentra disponible, el uso de <filename>.htaccess</filename>
       es tambi&eacute;n una opci&oacute;n. Por ejemplo:
      </para>
      <screen>
<![CDATA[
php_flag magic_quotes_gpc Off
]]>
      </screen>
     </example>
    </para>
    <para>
     Con el prop&oacute;sito de escribir c&oacute;digo portable
     (c&oacute;digo que funciona en cualquier entorno), por ejemplo si
     la configuraci&oacute;n en el nivel del servidor no es posible,
     he aqu&iacute; un ejemplo de c&oacute;mo deshabilitar <link
     linkend="ini.magic-quotes-gpc">magic_quotes_gpc</link> en tiempo
     de ejecuci&oacute;n. Este m&eacute;todo es ineficiente as&iacute;
     que es preferible definir las directivas apropiadas en
     alg&uacute;n otro lugar.
    </para>
    <para>
     <example>
      <title>Deshabilitir comillas m&aacute;gicas en tiempo de
      ejecuci&oacute;n</title>
      <programlisting role="php">
<![CDATA[
<?php
if (get_magic_quotes_gpc()) {
    function stripslashes_profundo($valor)
    {
        $valor = is_array($valor) ?
                    array_map('stripslashes_profundo', $valor) :
                    stripslashes($valor);

        return $valor;
    }

    $_POST = array_map('stripslashes_profundo', $_POST);
    $_GET = array_map('stripslashes_profundo', $_GET);
    $_COOKIE = array_map('stripslashes_profundo', $_COOKIE);
}
?>
]]>
      </programlisting>
     </example>
    </para>
   </sect1>

  </chapter>

<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-omittag:t
sgml-shorttag:t
sgml-minimize-attributes:nil
sgml-always-quote-attributes:t
sgml-indent-step:1
sgml-indent-data:t
indent-tabs-mode:nil
sgml-parent-document:nil
sgml-default-dtd-file:"../../manual.ced"
sgml-exposed-tags:nil
sgml-local-catalogs:nil
sgml-local-ecat-files:nil
End:
vim600: syn=xml fen fdm=syntax fdl=2 si
vim: et tw=78 syn=sgml
vi: ts=1 sw=1
-->
