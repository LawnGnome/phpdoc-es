<?xml version="1.0" encoding="utf-8"?>
<!-- $Revision: 1.4 $ -->
<!-- EN-Revision: 1.11 Maintainer: lboshell Status: ready -->
<!-- State: deprecated -->

 <reference xml:id="ref.sesam" xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">
  <title>Funciones de Base de Datos SESAM</title>
  <titleabbrev>SESAM</titleabbrev>

  <partintro>
   <section xml:id="sesam.intro">
    &reftitle.intro;
    <para>
     SESAM/SQL-Server es un sistema de bases de datos para
     macrocomputadoras, desarrollado por Fujitsu Siemens Computers,
     Alemania. Corre en servidores tipo mainframe de alto orden usando el
     sistema operativo BS2000/OSD.
    </para>
    <para>
     En numerosas instalaciones productivas de BS2000, SESAM/SQL-Server ha
     probado
     <itemizedlist>
      <listitem>
       <simpara>
        la facilidad de uso de conectividad Java, Web y cliente/servidor,
       </simpara>
      </listitem>
      <listitem>
       <simpara>
        la capacidad de trabajar con una disponibilidad de más del 99.99%,
       </simpara>
      </listitem>
      <listitem>
       <simpara>
        la habilidad de manejar decenas e incluso cientos de miles de
        usuarios.
       </simpara>
      </listitem>
    </itemizedlist>
    </para>
    <para>
     Existe una interfaz SESAM para PHP 3 disponible que permite operaciones
     de bases de datos a través de scripts PHP.
    </para>
    <note>
     <simpara>
      El acceso a SESAM solo se encuentra disponible con la última versión
      CVS de PHP 3. PHP 4 no tiene soporte para la base de datos SESAM.
     </simpara>
    </note>
   </section>

   &reference.sesam.ini;

   <section xml:id="sesam.config-notes">
    <title>Notas de configuración</title>
    <para>
     No existe soporte independiente para la interfaz PHP SESAM, solo
     trabaja como un módulo integrado de Apache. En el módulo de PHP Apache,
     esta <link linkend="sesam.configuration">interfaz SESAM es
     configurada</link> usando directivas de Apache.
     <table>
      <title>Directivas de Configuración de SESAM</title>
      <tgroup cols="2">
       <thead>
        <row>
         <entry>Directiva</entry>
         <entry>Significado</entry>
        </row>
       </thead>
       <tbody>
        <row>
         <entry><literal>php3_sesam_oml</literal></entry>
         <entry>
          <para>
           Nombre de la biblioteca BS2000 PLAM que contiene los módulos
           cargables del controlador SESAM. Valor requerido para el uso de
           funciones SESAM.
          </para>
          <para>
           Ejemplo:
           <informalexample>
            <programlisting role="apache">
<![CDATA[
php3_sesam_oml $.SYSLNK.SESAM-SQL.030
]]>
            </programlisting>
           </informalexample>
          </para>
         </entry>
        </row>
        <row>
         <entry><literal>php3_sesam_configfile</literal></entry>
         <entry>
          <para>
           Nombre del archivo de configuración de la aplicación SESAM. Valor
           requerido para el uso de funciones SESAM.
          </para>
          <para>
           Ejemplo:
           <informalexample>
            <programlisting role="apache">
<![CDATA[
php3_sesam_configfile $SESAM.SESAM.CONF.AW
]]>
            </programlisting>
           </informalexample>
           Usualmente contendrá una configuración como (vea el manual de
           referencia de SESAM):
           <informalexample>
            <programlisting role="bs2000">
<![CDATA[
CNF=B
NAM=K
NOTYPE
]]>
            </programlisting>
           </informalexample>
          </para>
         </entry>
        </row>
        <row>
         <entry><literal>php3_sesam_messagecatalog</literal></entry>
         <entry>
          <para>
           Nombre del archivo de catálogo de mensajes SESAM. En la mayoría
           de casos, esta directiva no es necesaria. Solo si el archivo de
           mensajes SESAM no está instalado en la tabla de archivos de
           mensajes BS2000 del sistema, puede definirse con esta directiva.
          </para>
          <para>
           Ejemplo:
           <informalexample>
            <programlisting role="apache">
<![CDATA[
php3_sesam_messagecatalog $.SYSMES.SESAM-SQL.030
]]>
            </programlisting>
           </informalexample>
          </para>
         </entry>
        </row>
       </tbody>
      </tgroup>
     </table>
    </para>
    <para>
     Adicionalmente a la configuración de la interfaz PHP/SESAM, es
     necesario configurar el servidor de Bases de Datos SESAM mismo en su
     macrocomputadora, como es normal. Eso quiere decir:
     <itemizedlist>
      <listitem>
       <simpara>
        iniciar el gestor de base de datos SESAM (DBH), y
       </simpara>
      </listitem>
      <listitem>
       <simpara>
        conectar las bases de datos con el gestor de bases de datos SESAM
       </simpara>
      </listitem>
     </itemizedlist>
    </para>
    <para>
     Para obtener una conexión entre un script PHP y el gestor de bases de
     datos, los parámetros <literal>CNF</literal> y <literal>NAM</literal>
     del archivo de configuración SESAM seleccionado deben coincidir con el
     id del gestor de bases de datos iniciado.
    </para>
    <para>
     En caso de bases de datos distribuidas es necesario iniciar un agente
     SESAM/SQL-DCN con la tabla de distribución incluyendo los nombres de
     máquina huésped y base de datos.
    </para>
    <para>
     La comunicación entre PHP (corriendo en el subsistema POSIX) y el
     gestor de bases de datos (corriendo por fuera del subsistema POSIX) es
     realizada por el uso de memoria común entre un módulo controlador
     especial llamado SQLSCI y los módulos de conexión SESAM. Debido al
     acceso de memoria común, y debido a que PHP es una parte estática del
     servidor web, los accesos a bases de datos son bastante ágiles, ya que
     no requieren accesos remotos mediante ODBC, JDBC o UTM.
    </para>
    <para>
     Solamente un pequeño segmento de cargador (SESMOD) es enlazado con PHP,
     y los módulos de conexión SESAM son traídos desde la biblioteca OML
     PLAM de SESAM. En la <link
     linkend="sesam.configuration">configuración</link> es necesario
     indicarle a PHP el nombre de esta biblioteca PLAM, y el enlace de
     archivo a usar para el archivo de configuración SESAM (A partir de
     SESAM V3.0, SQLSCI está disponible en la biblioteca de Herramientas
     SESAM, que es parte de la distribución estándar).
    </para>
    <para>
     Debido a que el escapado para comillas sencillas en comandos SQL usa
     comillas sencillas duplicadas (en lugar de una comilla sencila
     precedida por una barra invertida, como en otras bases de datos), es
     recomendable definir las directivas de configuración de PHP <link
     linkend="ini.magic-quotes-gpc"><literal>php3_magic_quotes_gpc</literal></link>
     y <link
     linkend="ini.magic-quotes-sybase"><literal>php3_magic_quotes_sybase</literal></link>
     como <literal>On</literal> para todos los scripts PHP que usen la
     interfaz SESAM.
    </para>
   </section>

   <section xml:id="sesam.runtime">
    <title>Consideraciones de ejecución</title>
    <para>
     Debido a las limitaciones del modelo de proceso de BS2000, el
     controlador puede ser cargado únicamente después de que el servidor
     Apache haya creado sus procesos de servidor hijos. Esto reducirá
     ligeramente el rendimiento de la petición SESAM inicial de cada hijo,
     pero los accesos subsecuentes responderán a su rapidez máxima.
    </para>
    <para>
     Cuando se define explícitamente un Catálogo de Mensajes para SESAM, ese
     catálogo será cargado cada vez que el controlador sea cargado (es
     decir, en la petición inicial SESAM). El sistema operativo BS2000
     imprime un mensaje después de la carga exitosa del catálogo de
     mensajes, el cual será enviado al archivo error_log de Apache.
     Actualmente BS2000 no permite la supresión de este mensaje, así que
     irá alimentando gradualmente el registro de errores.
    </para>
    <para>
     Asegúrese de que la biblioteca OML PLAM de SESAM y el archivo de
     configuración de SESAM tengan permisos de lectura para el id de usuario
     usado para ejecutar el servidor web. De otra forma, el servidor será
     incapaz de leer el controlador, y no permitirá llamar las funciones
     SESAM. Asimismo, debe otorgarse acceso a la base de datos al id de
     usuario usado para ejecutar el servidor web. De otro modo, las
     conexiones al gestor de bases de datos SESAM fallará.
    </para>
   </section>

   <section xml:id="sesam.cursor-types">
    <title>Tipos de Cursor</title>
    <para>
     Los cursores de resultado que son generados para consultas SQL "tipo
     select" puede ser o "secuenciales" o "deslizables". Debido a la carga
     adicional extra de memoria requerida por los cursores "deslizables", el
     valor predeterminado es "secuenciales".
    </para>
    <para>
     Cuando se usan cursores "deslizables", el cursor puede ser posicionado
     libremente en el conjunto de resultados. Para cada consulta
     "deslizable", existen valores globales predeterminados para el tipo
     deslizable (inicializado a:
     <literal>SESAM_SEEK_NEXT</literal>) y el desplazamiento, que pueden ser
     definidos una vez con <function>sesam_seek_row</function> o cada vez
     que se recupera una fila usando <function>sesam_fetch_row</function>.
     Cuando se recupera una fila usando un cursor "deslizable", el siguiente
     post-procesamiento es realizado para los valores predeterminados
     globales para el tipo deslizable y el desplazamiento:
     <table>
      <title>Post-Procesamiento de Cursores Deslizables</title>
      <tgroup cols="2">
       <thead>
        <row>
         <entry>Tipo de Desplazamiento</entry>
         <entry>Acción</entry>
        </row>
       </thead>
       <tbody>
        <row>
         <entry><literal>SESAM_SEEK_NEXT</literal></entry>
         <entry>ninguna</entry>
        </row>
        <row>
         <entry><literal>SESAM_SEEK_PRIOR</literal></entry>
         <entry>ninguna</entry>
        </row>
        <row>
         <entry><literal>SESAM_SEEK_FIRST</literal></entry>
         <entry>
          establecer tipo de desplazamiento a
          <literal>SESAM_SEEK_NEXT</literal>
         </entry>
        </row>
        <row>
         <entry><literal>SESAM_SEEK_LAST</literal></entry>
         <entry>
          establecer tipo de desplazamiento a
          <literal>SESAM_SEEK_PRIOR</literal>
         </entry>
        </row>
        <row>
         <entry><literal>SESAM_SEEK_ABSOLUTE</literal></entry>
         <entry>Auto-Incrementar el valor de desplazamiento interno</entry>
        </row>
        <row>
         <entry><literal>SESAM_SEEK_RELATIVE</literal></entry>
         <entry>
          ninguna. (mantener el valor de
          <parameter>desplazamiento</parameter> global predeterminado, el
          cual permite p.ej. recuperar cada 10ma fila hacia atrás)
         </entry>
        </row>
       </tbody>
      </tgroup>
     </table>
    </para>
   </section>

   <section xml:id="sesam.porting-note">
    <title>Nota de adaptación</title>
    <para>
     Dado que en el mundo PHP es natural iniciar los índices en cero (en
     lugar de 1), algunos ajustes han sido realizados a la interfaz SESAM:
     cada vez que una matriz indexada arranca con el índice 1 en la interfaz
     SESAM nativa, la interfaz PHP usa el índice 0 como punto de partida.
     Por ejemplo, cuando se recuperan columnas con
     <function>sesam_fetch_row</function>, la primera columna tiene el
     índice 0, y las columnas subsecuentes tienen índices de hasta (pero sin
     incluir) el conteo de columnas ($matriz["count"]). Cuando se portan
     aplicaciones SESAM desde otros lenguajes de alto nivel a PHP, tenga
     presente este cambio de interfaz. Cuando sea apropiado, la descripción
     de las funciones sesam PHP respectivas incluyen una nota indicando que
     el índice tiene una base de cero.
    </para>
   </section>

   <section xml:id="sesam.security">
    <title>Consideraciones de seguridad</title>
    <para>
     Cuando se permite el acceso a bases de datos SESAM, el usuario del
     servidor web debería tener tan pocos privilegios como sea posible. Para
     la mayoría de bases de datos, solo deberían otorgarse permisos de
     lectura. Dependiendo de su escenario de uso, agregue más permisos de
     acceso de acuerdo a su criterio. ¡Nunca permita control completo a
     cualquier base de datos para cualquier usuario proveniente de la red!
     Restrinja el acceso de scripts PHP que deban administrar la base de
     datos usando un control de contraseñas y/o seguridad SSL.
    </para>
   </section>

   <section xml:id="sesam.migration">
    <title>Migración desde otras bases de datos SQL</title>
    <para>
     No existe una pareja de dialectos SQL 100% compatibles. Cuando se
     encuentre portando aplicaciones SQL desde otras interfaces de bases de
     dato a SESAM, puede que se requieran algunas ajustes. Las siguientes
     diferencias típicas deben ser notadas:
     <itemizedlist>
      <listitem>
       <simpara>Tipos de datos específicos</simpara>
       <simpara>
        Puede que algunos tipos de datos específicos tengan que ser
        reemplazados con tipos de datos SQL estándar (p.ej.,
        <literal>TEXT</literal> podría reemplazarse con
        <literal>VARCHAR(tam. máximo)</literal>).
       </simpara>
      </listitem>
      <listitem>
       <simpara>Palabras clave como identificadores SQL</simpara>
       <simpara>
        Es SESAM (así como en SQL estándar), tales identificadores deben ser
        encerrados en dobles comillas (o renombrados).
       </simpara>
      </listitem>
      <listitem>
       <simpara>
        Longitud de despliegue en tipos de datos
       </simpara>
       <simpara>
        Los tipos de datos SESAM tienen una precisión, no una longitud de
        despliegue. En lugar de <literal>int(4)</literal> (uso requerido:
        enteros hasta '9999'), SESAM requiere simplemente
        <literal>int</literal> para un tamaño implícito de 31 bits.
        Asimismo, los únicos tipos de datos de fecha y hora disponibles en
        SESAM son: <literal>DATE</literal>, <literal>TIME(3)</literal> y
        <literal>TIMESTAMP(3)</literal>.
       </simpara>
      </listitem>
      <listitem>
       <simpara>
        Tipos SQL con los atributos específicos <literal>unsigned</literal>,
        <literal>zerofill</literal>, o <literal>auto_increment</literal>
       </simpara>
       <simpara>
        <literal>unsigned</literal> y <literal>zerofill</literal> no son
        soportados. <literal>auto_increment</literal> es automático (use
        <literal>"INSERT ...  VALUES(*, ...)"</literal> en lugar de
        <literal>"... VALUES(0, ...)"</literal> para aprovechar el
        auto-incremento implícito de SESAM.
       </simpara>
      </listitem>
      <listitem>
       <simpara>
        <command>int ... DEFAULT '0000'</command>
       </simpara>
       <simpara>
        Las variables numéricas no deben ser inicializadas con constantes
        tipo cadena. Use <command>DEFAULT 0</command> en su lugar. Para
        inicializar variables de los tipos de dato SQL de fecha y hora, la
        cadena de inicialización debe ser precedida por la palabra clave del
        tipo respectivo, de la siguiente manera: <literal>CREATE TABLE
        ejemplo ( xtime timestamp(3) DEFAULT TIMESTAMP '1970-01-01
        00:00:00.000' NOT NULL );</literal>
       </simpara>
      </listitem>
      <listitem>
       <simpara>
        <command>$conteo = xxxx_num_rows();</command>
       </simpara>
       <simpara>
        Algunas bases de datos prometen adivinar/estimar el número de filas
        en un resultado de consulta, aun cuando el valor devuelto es
        abruptamente incorrecto. SESAM no conoce el número de filas en un
        resultado de consulta antes de realizar la recuperación real. Si
        usted REALMENTE necesita el conteo, intente <command>SELECT
        COUNT(...) WHERE ...</command>, comando que le dirá el número de
        coincidencias. Una segunda consulta devolverá (probablemente) los
        resultados.
       </simpara>
      </listitem>
      <listitem>
       <simpara>
        <command>DROP TABLE nombre;</command>
       </simpara>
       <simpara>
        En SESAM, en el comando <command>DROP TABLE</command>, el nombre de
        la tabla debe ser seguido por la palabra clave
        <literal>RESTRICT</literal> o <literal>CASCADE</literal>. Cuando se
        especifica <literal>RESTRICT</literal>, un error es devuelto si hay
        objetos dependientes (p.ej., VIEWs), mientras que con
        <literal>CASCADE</literal>, los objetos dependientes serán
        eliminados junto con la tabla especificada.
       </simpara>
      </listitem>
     </itemizedlist>
    </para>
   </section>

   <section xml:id="sesam.sql-types">
    <title>
     Notas sobre el uso de varios tipos SQL
    </title>
    <para>
     SESAM no soporta en la actualidad el tipo BLOB. Una versión futura de
     SESAM tendrá soporte para ese tipo.
    </para>
    <para>
     En la interfaz PHP, las siguientes conversiones de tipos son aplicadas
     automáticamente cuando se recuperan campos SQL:
     <table>
      <title>Conversiones de tipos de SQL a PHP</title>
      <tgroup cols="2">
       <thead>
        <row>
         <entry>Tipo SQL</entry>
         <entry>Tipo PHP</entry>
        </row>
       </thead>
       <tbody>
        <row>
         <entry>SMALLINT, INTEGER</entry>
         <entry><type>integer</type></entry>
        </row>
        <row>
         <entry>NUMERIC, DECIMAL, FLOAT, REAL, DOUBLE</entry>
         <entry><type>float</type></entry>
        </row>
        <row>
         <entry>DATE, TIME, TIMESTAMP</entry>
         <entry><type>string</type></entry>
        </row>
        <row>
         <entry>VARCHAR, CHARACTER</entry>
         <entry><type>string</type></entry>
        </row>
       </tbody>
      </tgroup>
     </table>
     Cuando se recupera una fila completa, el resultado es devuelto como una
     matriz. Los campos vacíos no son llenados, así que tendrá que chequear
     por la existencia de campos individuales usted mismo (use
     <function>isset</function> o <function>empty</function> para probar si
     un campo está vacío). Eso le permite más control al usuario en
     comparación con la apariencia de campos vacíos (en el caso de una
     cadena vacía como representación de un campo vacío).
    </para>
   </section>

   <section xml:id="sesam.multiple-fields">
    <title>Soporte para la característica de "campos múltiples" de
    SESAM</title>
    <para>
     La característica especial de "campos múltiples" de SESAM permite que
     una columna consista de una matriz de campos. Tal tipo de columna de
     "múltiples campos" puede ser creada de la siguiente forma:
     <example>
      <title>Creación de una columna de "campo múltiple"</title>
      <programlisting role="sesam">
<![CDATA[
CREATE TABLE prueba_multi_campo (
    clave CHAR(20) PRIMARY KEY,
    multi(3) CHAR(12)
)
]]>
      </programlisting>
     </example>
     y puede ser llenada usando:
     <example>
      <title>Llenado de una columna de "campo múltiple"</title>
      <programlisting role="sesam">
<![CDATA[
INSERT INTO prueba_multi_campo (clave, multi(2..3) )
    VALUES ('Segundo', <'primer_valor', 'segundo_valor'>)
]]>
      </programlisting>
     </example>
     Note que (como en este caso) los sub-campos iniciales vacíos son
     ignorados, y los valores llenados son colapsados, así que en el ejemplo
     anterior el resultado aparecerá como multi(1..2) en lugar de
     multi(2..3).
    </para>
    <para>
     Cuando se recupera una fila de resultado, las "columnas múltiples" son
     leídas como columnas adicionales "internas". En el ejemplo anterior,
     "clave" tendrá el índice 0, y las tres columnas "multi(1..3)" estarán
     disponibles como los índices 1 a 3.
    </para>
   </section>

   <section xml:id="sesam.seealso">
   &reftitle.seealso;
    <para>
     Para detalles específicos de SESAM, por favor refiérase a <link
     xlink:href="&url.sesam.en;">la decumentación SESAM/SQL-Server (en
     inglés)</link> o <link xlink:href="&url.sesam.de;">la documentación
     SESAM/SQL-Server (en alemán)</link>, ambas disponibles en línea, o use
     los manuales respectivos.
   </para>
   </section>

  </partintro>

&reference.sesam.functions;

 </reference>

<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-omittag:t
sgml-shorttag:t
sgml-minimize-attributes:nil
sgml-always-quote-attributes:t
sgml-indent-step:1
sgml-indent-data:t
indent-tabs-mode:nil
sgml-parent-document:nil
sgml-default-dtd-file:"../../../manual.ced"
sgml-exposed-tags:nil
sgml-local-catalogs:nil
sgml-local-ecat-files:nil
End:
vim600: syn=xml fen fdm=syntax fdl=2 si
vim: et tw=78 syn=sgml
vi: ts=1 sw=1
-->
