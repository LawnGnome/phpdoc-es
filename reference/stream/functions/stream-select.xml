<?xml version="1.0" encoding="utf-8"?>
<!-- $Revision$ -->
<!-- EN-Revision: n/a Maintainer: lboshell Status: ready -->
  <refentry xml:id="function.stream-select" xmlns="http://docbook.org/ns/docbook">
   <refnamediv>
    <refname>stream_select</refname>
    <refpurpose>Ejecuta el equivalente al llamado de sistema select() en la
    matriz de secuencias dada, con un tiempo de espera especificado por
    tv_sec y tv_usec</refpurpose>
   </refnamediv>
   <refsect1>
    <title>Descripción</title>
     <methodsynopsis>
      <type>int</type><methodname>stream_select</methodname>
      <methodparam><type>array</type><parameter role="reference">lectura</parameter></methodparam>
      <methodparam><type>array</type><parameter role="reference">escritura</parameter></methodparam>
      <methodparam><type>array</type><parameter role="reference">excepcional</parameter></methodparam>
      <methodparam><type>int</type><parameter>tv_sec</parameter></methodparam>
      <methodparam choice="opt"><type>int</type><parameter>tv_usec</parameter></methodparam>
     </methodsynopsis>
    <simpara>
     La función <function>stream_select</function> acepta una matriz de
     secuencias y espera a que éstas cambien su status. Su operación es
     equivalente a la de la función <function>socket_select</function>,
     excepto que actúa sobre secuencias.
    </simpara>
    <simpara>
     Las secuencias listadas en la matriz <parameter>lectura</parameter>
     serán vigiladas para ver si aparecen caracteres disponibles para
     lectura (o más precisamente, para ver si una operación de lectura no
     producirá un bloqueo - en particular, un recurso de secuencia se
     encuentra listo también al llegar al final del archivo, en cuyo caso un
     llamado a <function>fread</function> devolverá una cadena de longitud
     cero).
    </simpara>
    <simpara>
     Las secuencias listadas en la matriz <parameter>escritura</parameter>
     serán vigiladas para ver si una escritura no crea bloqueos.
    </simpara>
    <simpara>
     Las secuencias listadas en la matriz <parameter>excepcional</parameter>
     serán vigiladas por la llegada de datos excepcionales ("out-of-band")
     de alta prioridad.
    </simpara>
    <note>
     <para>
      Cuando <function>stream_select</function> devuelve un valor, las
      matrices <parameter>lectura</parameter>,
      <parameter>escritura</parameter> y <parameter>excepcional</parameter>
      son modificadas para indicar cuáles recursos de secuencia modificaron
      su status en realidad.
     </para>
    </note>
    <simpara>
     Los parámetros <parameter>tv_sec</parameter> y
     <parameter>tv_usec</parameter>, juntos forman el parámetro
     <emphasis>tiempo de espera</emphasis>, <parameter>tv_sec</parameter>
     especifica el número de segundos, mientras que
     <parameter>tv_usec</parameter> el número de microsegundos. El
     <emphasis>tiempo de espera</emphasis> es un límite superior sobre la
     cantidad de tiempo que <function>stream_select</function> esperará
     antes de devolver un valor. Si tanto <parameter>tv_sec</parameter> como
     <parameter>tv_usec</parameter> son definidos como <literal>0</literal>,
     <function>stream_select</function> no esperará por datos - en su lugar
     devolverá un valor inmediatamente, indicando el status actual de las
     secuencias. Si <parameter>tv_sec</parameter> es &null;
     <function>stream_select</function> puede crear un bloqueo
     indefinidamente, y sólo devolverá un valor cuando ocurra un evento en
     alguna de las secuencias vigiladas (o si una señal interrumpe el
     llamado de sistema).
    </simpara>
    <simpara>
     En caso de éxito, <function>stream_select</function> devuelve el número
     de recursos de secuencia modificados contenidos en las matrices, que
     puede ser cero si el tiempo de espera expira antes de que algo
     interesante suceda. En caso de fallo, el valor &false; es devuelto y se
     genera una advertencia (esto puede pasar si el llamado de sistema es
     interrumpido por una señal entrante).
    </simpara>

    <warning>
     <para>
      El uso de un valor de tiempo de espera de <literal>0</literal> le
      permite consultar el status de las secuencias de forma instantánea,
      sin embargo, NO es buena idea usar un valor de tiempo de espera de
      <literal>0</literal> en un ciclo, dado que causará que su script
      consuma mucho tiempo de CPU.
     </para>
     <para>
      Es mucho mejor especificar un valor de tiempo de espera de algunos
      pocos segundos, aunque si necesita hacer chequeos y ejecutar otro
      segmento de código concurrentemente, usar un valor de tiempo de espera
      de por lo menos <literal>200000</literal> microsegundos le ayudará a
      reducir el uso de CPU de su script.
     </para>
     <para>
      Recuerde que el valor de tiempo de espera es el tiempo máximo que
      transcurrirá; <function>stream_select</function> devolverá un valor
      tan pronto como las secuencias solicitadas se encuentren listas para
      su uso.
     </para>
    </warning>
    <simpara>
     No necesita pasar cada matriz a <function>stream_select</function>.
     Puede dejar de especificarlas y usar una matriz vacía o &null; en su
     lugar. Tampoco olvide que estas matrices son pasadas <emphasis>por
     referencia</emphasis> y serán modificadas después de que
     <function>stream_select</function> devuelva un valor.
    </simpara>
    <para>
     Este ejemplo revisa si han llegado datos para lectura ya sea en
     <parameter>$secuencia1</parameter> o en
     <parameter>$secuencia2</parameter>. Dado que el valor de tiempo de
     espera es <literal>0</literal>, la función retornará inmediatamente:
     <programlisting role="php">
<![CDATA[
<?php
/* Preparar la matriz de lectura */
$lectura   = array($secuencia1, $secuencia2);
$escritura  = NULL;
$excepcional = NULL;
if (false === ($num_secuencias_modificadas = stream_select($lectura, $escritura, $excepcional, 0))) {
    /* Gestión de errores */
} elseif ($num_secuencias_modificadas > 0) {
    /* En por lo menos una de las secuencias ha ocurrido algo interesante */
}
?>
]]>
     </programlisting>
    </para>
    <note>
     <para>
      Debido a una limitación en el Motor Zend actual, no es posible pasar
      un modificador constante como &null; directamente como parámetro a una
      función que espera que tal parámetro sea pasado por referencia. En su
      lugar, use una variable temporal o una expresión en donde el miembro
      del lado izquierdo sea una variable temporal:
      <programlisting role="php">
<![CDATA[
<?php
$ex = NULL;
stream_select($lec, $esc, $ex, 0);
?>
]]>
     </programlisting>
     </para>
    </note>
    <note>
     <para>
      Asegúrese de usar el operador <literal>===</literal> cuando efectúe
      chequeos de error. Dado que <function>stream_select</function> puede
      devolver 0, la comparación con <literal>==</literal> evaluaría a
      &true;:
     <programlisting role="php">
<![CDATA[
<?php
$ex = NULL;
if (false === stream_select($lec, $esc, $ex, 0)) {
    echo "stream_select() falló\n";
}
?>
]]>
     </programlisting>
     </para>
    </note>
    <note>
     <para>
      Si lee/escribe sobre una secuencia devuelta con las matrices, tenga en
      cuenta que éstas no necesariemente leen/escriben la cantidad completa
      de datos que usted ha solicitado. Prepárese para gestionar incluso la
      lectura/escritura de un solo byte.
     </para>
    </note>
    <note>
     <para>
      Compatibilidad con Windows: El uso de
      <function>stream_select</function> sobre un pipe devuelto desde
      <function>proc_open</function> puede causar pérdida de datos bajo
      Windows 98.
     </para>
     <para>
      El uso de <function>stream_select</function> con descriptores de
      archivo devueltos por <function>proc_open</function> fallará y
      devolverá &false; bajo Windows.
     </para>
    </note>
    <para>
     Vea también <function>stream_set_blocking</function>.
    </para>
   </refsect1>
  </refentry>

<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-omittag:t
sgml-shorttag:t
sgml-minimize-attributes:nil
sgml-always-quote-attributes:t
sgml-indent-step:1
sgml-indent-data:t
indent-tabs-mode:nil
sgml-parent-document:nil
sgml-default-dtd-file:"../../../../manual.ced"
sgml-exposed-tags:nil
sgml-local-catalogs:nil
sgml-local-ecat-files:nil
End:
vim600: syn=xml fen fdm=syntax fdl=2 si
vim: et tw=78 syn=sgml
vi: ts=1 sw=1
-->
