<?xml version="1.0" encoding="utf-8"?>
<!-- $Revision: 1.6 $ -->
<!-- EN-Revision: 1.15 Maintainer: lboshell Status: ready -->
<refentry xml:id="function.flock" xmlns="http://docbook.org/ns/docbook">
 <refnamediv>
  <refname>flock</refname>
  <refpurpose>Aviso de bloqueo de archivos portable</refpurpose>
 </refnamediv>

 <refsect1 role="description">
  &reftitle.description;
  <methodsynopsis>
   <type>bool</type><methodname>flock</methodname>
   <methodparam><type>resource</type><parameter>gestor</parameter></methodparam>
   <methodparam><type>int</type><parameter>operacion</parameter></methodparam>
   <methodparam choice="opt"><type>int</type><parameter role="reference">bloquearia</parameter></methodparam>
  </methodsynopsis>
  <para>
   <function>flock</function> le permite ejecutar un modelo de
   lectura/escritura simple que puede ser usado en prácticamente cualquier
   plataforma (incluyendo la mayoría de derivaciones de Unix e incluso
   Windows).
  </para>
  <para>
   El bloqueo es liberado también por <function>fclose</function> (el cual
   es llamado automáticamente cuando el script finaliza).
  </para>
  <para>
   PHP soporta una manera portable de bloquear archivos enteros de por medio
   de avisos (lo que quiere decir que todos los programas que acceden al
   archivo deben usar el mismo mecanismo de bloqueo, o no funcionará).
  </para>
 </refsect1>

 <refsect1 role="parameters">
  &reftitle.parameters;
  <para>
   <variablelist>
    <varlistentry>
     <term><parameter>gestor</parameter></term>
     <listitem>
      <para>
       Un apuntador de archivo abierto.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><parameter>operacion</parameter></term>
     <listitem>
      <para>
       <parameter>operacion</parameter> es uno de los siguientes valores:
       <itemizedlist>
        <listitem>
         <simpara>
          <constant>LOCK_SH</constant> para adquirir un bloqueo compartido
          (lectura).
         </simpara>
        </listitem>
        <listitem>
         <simpara>
          <constant>LOCK_EX</constant> para adquirir un bloque exclusivo
          (escritura).
         </simpara>
        </listitem>
        <listitem>
         <simpara>
          <constant>LOCK_UN</constant> para liberar un bloqueo (compartido o
          exclusivo).
         </simpara>
        </listitem>
        <listitem>
         <simpara>
          <constant>LOCK_NB</constant> si no desea que
          <function>flock</function> bloquee las operaciones de
          entrada/salida mientras esté activo.
         </simpara>
        </listitem>
       </itemizedlist>
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><parameter>bloquearia</parameter></term>
     <listitem>
      <para>
       El tercer argumento opcional recibe el valor &true; si el aviso
       produciría un bloqueo (la condición EWOULDBLOCK).
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </para>
 </refsect1>

 <refsect1 role="returnvalues">
  &reftitle.returnvalues;
  <para>
   &return.success;
  </para>
 </refsect1>

 <refsect1 role="changelog">
  &reftitle.changelog;
  <para>
   <informaltable>
    <tgroup cols="2">
     <thead>
      <row>
       <entry>&Version;</entry>
       <entry>&Description;</entry>
      </row>
     </thead>
     <tbody>
      <row>
       <entry>4.0.1</entry>
       <entry>
        Las constantes <literal>LOCK_XXX</literal> fueron agregadas. Antes
        de esta versión, era necesario usar 1 para
        <constant>LOCK_SH</constant>, 2 para <constant>LOCK_EX</constant>, 3
        para <constant>LOCK_UN</constant> y 4 para
        <constant>LOCK_NB</constant>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </para>
 </refsect1>

 <refsect1 role="examples">
  &reftitle.examples;
  <para>
   <example>
    <title>Ejemplo de <function>flock</function></title>
    <programlisting role="php">
<![CDATA[
<?php

$aa = fopen("/tmp/bloqueo.txt", "w+");

if (flock($aa, LOCK_EX)) { // realizar un bloqueo exclusivo
    fwrite($aa, "Escribir algo aquí\n");
    flock($aa, LOCK_UN); // liberar el aviso
} else {
    echo "¡No se pudo bloquear el archivo!";
}

fclose($aa);

?>
]]>
    </programlisting>
   </example>
  </para>
 </refsect1>

 <refsect1 role="notes">
  &reftitle.notes;
  <note>
   <para>
    <function>flock</function> es obligatorio bajo Windows.
   </para>
  </note>
  <note>
   <para>
    Dado que <function>flock</function> requiere un apuntador de archivo,
    puede que necesite usar un archivo especial de bloqueo para proteger el
    acceso a un archivo que pretende truncar abriéndolo en modo de escritura
    (con un argumento "w" o "w+" a <function>fopen</function>).
   </para>
  </note>
  <warning>
   <para>
    <function>flock</function> no trabajará sobre NFS y muchos otros
    sistemas de archivos en red. Revise la documentación de su sistema
    operativo para más detalles.
   </para>
   <para>
    En algunos sistemas operativos <function>flock</function> se implementa
    al nivel de proceso. Cuando usa una API de servidor multi-hilos como
    ISAPI, ¡es posible que no pueda depender en <function>flock</function>
    para proteger archivos contra otros scripts PHP corriendo en hilos
    paralelos en la misma instancia de servidor!
   </para>
   <para>
    <function>flock</function> no es soportado en sistemas de archivos
    anticuados como <literal>FAT</literal> y sus derivados, y por lo tanto
    siempre devolverá &false; bajo tales entornos (esto es especialmente
    cierto para usuarios de Windows 98).
   </para>
  </warning>
 </refsect1>

</refentry>

<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-omittag:t
sgml-shorttag:t
sgml-minimize-attributes:nil
sgml-always-quote-attributes:t
sgml-indent-step:1
sgml-indent-data:t
indent-tabs-mode:nil
sgml-parent-document:nil
sgml-default-dtd-file:"../../../../manual.ced"
sgml-exposed-tags:nil
sgml-local-catalogs:nil
sgml-local-ecat-files:nil
End:
vim600: syn=xml fen fdm=syntax fdl=2 si
vim: et tw=78 syn=sgml
vi: ts=1 sw=1
-->
