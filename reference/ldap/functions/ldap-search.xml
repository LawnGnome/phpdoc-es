<?xml version="1.0" encoding="iso-8859-1"?>
<!-- $Revision: 1.3 $ -->
<!-- EN-Revision: 1.7 Maintainer: javi Status: ready -->
<!-- splitted from ./en/functions/ldap.xml, last change in rev 1.17 -->
  <refentry xml:id="function.ldap-search" xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">
   <refnamediv>
    <refname>ldap_search</refname>
    <refpurpose>Busca en un arbol LDAP</refpurpose>
   </refnamediv>
   <refsect1>
    <title>Descripci&oacute;n</title>
     <methodsynopsis>
      <type>resource</type><methodname>ldap_search</methodname>
      <methodparam><type>resource</type><parameter>identificador_de_conexion</parameter></methodparam>
      <methodparam><type>string</type><parameter>dn_base</parameter></methodparam>
      <methodparam><type>string</type><parameter>filtro</parameter></methodparam>
      <methodparam choice="opt"><type>array</type><parameter>atributos</parameter></methodparam>
      <methodparam choice="opt"><type>int</type><parameter>solo_atributos</parameter></methodparam>
      <methodparam choice="opt"><type>int</type><parameter>tamano_limite</parameter></methodparam>
      <methodparam choice="opt"><type>int</type><parameter>tiempo_limite</parameter></methodparam>
      <methodparam choice="opt"><type>int</type><parameter>deref</parameter></methodparam>
     </methodsynopsis>
    <para>
     Devuelve un identificador de resultado de b&uacute;squeda o &false; en caso de error.</para>
    <para>  
     <function>ldap_search</function> realiza la b&uacute;squeda seg&uacute;n el filtro
     especificado con alcance LDAP_SCOPE_SUBTREE. Esto es equivalente a
     buscar en el directorio entero. <parameter>dn_base</parameter>
     especifica el DN base para el directorio.</para>
    <para>
     Existe un cuarto par&aacute;metro opcional que puede ser a&ntilde;adido
     para restringir los atributos y valores devueltos por el
     servidor a s&oacute;lo los requeridos. Es mucho m&aacute;s eficiente que la
     acci&oacute;n por defecto (que devolver&aacute; todos los atributos y sus
     valores asociados). El uso del cuarto par&aacute;metro debe ser por
     tanto considerado una pr&aacute;ctica recomendable.</para>
    <para>
     El cuerto par&aacute;metro es un array est&aacute;ndar de PHP con los atributos
     requeridos, por ejemplo array("mail","sn","cn"). Nota: "dn" siempre es
     devuelto independientemente de que tipos de atributos sean
     solicitados.</para>
    <para>
     Tambi&eacute;n hay que tener en cuenta que algunos servidores de directorio
     est&aacute;n configurados para devolver un cierto n&uacute;mero de entradas como
     m&aacute;ximo. Si esto ocurre, el servidor indicar&aacute; que solo devuelve
     un conjunto parcial de los resultados. Esto tambi&eacute;n se produce si 
	 el sexto par&aacute;metro <parameter>tamano_limite</parameter> se emplea para 
	 limitar el n&uacute;mero de entradas devueltas.</para> 
    <para>
     El quinto par&aacute;metro <parameter>solo_atributos</parameter> se puede poner 
	 a 1 si solo se quieren obtener los tipos de los atributos. Si se le da un valor 
	 de 0, se obtienen los tipos de los atributos y sus valores, que es el comportamiento 
	 por defecto.
    </para>
	<para>
     El sexto par&aacute;metro <parameter>tamano_limite</parameter> permite limitar 
	 el n&uacute;mero de entradas devueltas. Si se le da un valor de 0, no se establece 
	 ning&uacute;n l&iacute;mite. 
     NOTA: Este par&aacute;metro no prevalece sobre los l&iacute;mites establecidos 
	 por el servidor, aunque si que permite establecerlo a un valor inferior.
    </para> 
    <para>
	 El s&eacute;ptimo par&aacute;metro <parameter>tiempo_limite</parameter> 
	 establece el n&uacute;mero de segundos que se dedica a realizar la 
	 b&uacute;squeda. Si se le da un valor de 0, no se establece 
	 ning&uacute;n l&iacute;mite. 
     NOTA: Este par&aacute;metro no prevalece sobre los l&iacute;mites establecidos 
	 por el servidor, aunque si que permite establecerlo a un valor inferior.
    </para> 
    <para>
     El octavo par&aacute;metro <parameter>deref</parameter> especifica como se 
	 tratan los alias durante la b&uacute;squeda. Su valor debe ser uno de los 
	 siguientes:
     <itemizedlist>
     <listitem>
      <simpara>
       LDAP_DEREF_NEVER - (valor por defecto) los alias nunca se dereferencian.
      </simpara>
     </listitem>
     <listitem>
      <simpara>
       LDAP_DEREF_SEARCHING - los alias se deben dereferenciar durante las b&uacute;squedas 
	   pero no cuando se busca el objeto base de la b&uacute;squeda.
      </simpara>
     </listitem>
     <listitem>
      <simpara>
       LDAP_DEREF_FINDING - los alias se deben dereferenciar cuando se busca el objeto base de la 
	   b&uacute;squeda pero no durante la b&uacute;squeda.
      </simpara>
     </listitem>
     <listitem>
      <simpara>
       LDAP_DEREF_ALWAYS - los alias se deben dereferenciar siempre.
      </simpara>
     </listitem>
     </itemizedlist>
    </para>  
    <note>
     <para>
      Los siguientes par&aacute;metros opcionales se a&ntilde;adieron en la versi&oacute;n de PHP 4.0.2:
      <parameter>solo_atributos</parameter>,
      <parameter>tamano_limite</parameter>,
      <parameter>tiempo_limite</parameter>,
      <parameter>deref</parameter>.
     </para>
    </note>
    <para>
     El filtro de b&uacute;squeda puede ser simple o avanzado, para lo que se 
	 utilizan operadores booleanos con el formato descrito en la documentaci&oacute;n 
	 de LDAP (acceda a <link xlink:href="&url.ldap.filters;">Netscape Directory SDK</link>
     para obtener la informaci&oacute;n completa sobre los filtros).</para>
    <para>
     El siguiente ejemplo recupera la unidad organizativa (ou), apellidos
     nombre com&uacute;n y direcci&oacute;n de email para todas las personas de
     "Mi Compa&ntilde;&iacute;a", donde los apellidos o el nombre com&uacute;n contienen la
     subcadena $persona. Este ejemplo usa un filtro booleano para
     indicar al servidor que busque la informaci&oacute;n en m&aacute;s de un atributo.

     <example>
      <title>B&uacute;squeda LDAP</title>
<programlisting role="php">
<![CDATA[
<?php
// $ds es un identificador de conexion valido

// $persona es todo o parte del nombre de una persona, por ejemplo "Pe"

$dn = "o=Mi Compania, c=ES";
$filtro="(|(sn=$persona*)(givenname=$persona*))";
$solonecesito = array( "ou", "sn", "givenname", "mail");

$sr=ldap_search($ds, $dn, $filtro, $solonecesito);

$info = ldap_get_entries($ds, $sr);

echo $info["count"]." entradas devueltas\n";
?>
]]>
</programlisting>
      </example>
	</para>
	<para>
     A partir de la versi&oacute;n de PHP 4.0.5 es posible realizar b&uacute;squedas 
	 en paralelo. Para ello, se debe usar un array de identificadores de conexiones en lugar 
	 del habitual identificador de conexi&oacute;n simple.
	 Si no se van a emplear los mismos DN base y los mismos filtros para todas las 
	 b&uacute;squedas, es posible indicar arrays para los DN base y los filtros.
	 Estos arrays deben tener el mismo tama&ntilde;o que el empleado para indicar 
	 el array de identificadores de conexiones.
	 Al hacer b&uacute;squedas paralelas, se devuelve un array de resultados de 
	 b&uacute;squeda, excepto si se produce un error, en cuyo caso el valor devuelto 
	 es &false;. Este comportamiento es muy parecido al habitual, salvo que antes 
	 siempre se devolv&iacute;a un identificador de resultado cuando se hac&iacute;a 
	 una b&uacute;squeda.
	 Por tanto, pueden darse casos extra&ntilde;os en los que una b&uacute;squeda normal 
	 devuelva &false; y la b&uacute;squeda paralela devuelva un identificador.
    </para>
   </refsect1>
  </refentry>

<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-omittag:t
sgml-shorttag:t
sgml-minimize-attributes:nil
sgml-always-quote-attributes:t
sgml-indent-step:1
sgml-indent-data:t
indent-tabs-mode:nil
sgml-parent-document:nil
sgml-default-dtd-file:"../../../../manual.ced"
sgml-exposed-tags:nil
sgml-local-catalogs:nil
sgml-local-ecat-files:nil
End:
vim600: syn=xml fen fdm=syntax fdl=2 si
vim: et tw=78 syn=sgml
vi: ts=1 sw=1
-->
