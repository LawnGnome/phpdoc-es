<?xml version="1.0" encoding="iso-8859-1"?>
<!-- $Revision: 1.8 $ -->
<!-- EN-Revision: 1.13 Maintainer: javi Status: ready -->
 <reference id="ref.ldap">
 <title>Funciones LDAP</title>
 <titleabbrev>LDAP</titleabbrev>
 
 <partintro>
  <section id="ldap.intro">
   &reftitle.intro;
   <para>
    LDAP es el protocolo simple de acceso a directorios (Lightweight
    Directory Access Protocol), un protocolo usado para acceder a
    "Servidores de Directorio".  El directorio es una clase especial
    de base de datos que contiene informaci&oacute;n estructurada en
    forma de &aacute;rbol.
   </para>
   <para>
    El concepto es similar a la estructura de directorios de los
    discos duros, pero en este caso, el directorio raiz es "El Mundo"
    y los subdirectorios de primer nivel son los "pa&iacute;ses".
    Niveles inferiores de la estructura de directorio contienen
    entradas para compa&ntilde;&iacute;as, organizaciones o lugares, y
    en niveles a&uacute;n m&aacute;s inferiores se encuentran las entradas para
    la gente, y en algunos casos equipos inform&aacute;ticos y
    documentos.
    </para>
   <para>
    Para referirse a un archivo en un subdirectorio del disco duro se
    usa algo como:
   </para>
   <literallayout>
    /usr/local/misapps/docs
   </literallayout>
   <para>
    Las barras marcan cada divisi&oacute;n en la referencia al
    archivo, y la secuencia es leida de izquierda a derecha.
   </para>
   <para>
    El equivalente a la referencia a un archivo en LDAP es el
    "distinguished name" (nombre distinguible), abreviado como "dn".
    Un ejemplo de dn podr&iacute;a ser.
   </para>
   <literallayout>
    cn=Pedro P&eacute;rez,ou=Contabilidad,o=Mi Compa&ntilde;&iacute;a,c=ES
   </literallayout>
   <para>
    Las comas marcan cada divisi&oacute;n en la referencia, y la
    secuencia se lee de derecha a izquierda.  Este dn se leer&iacute;a
    como:
   </para>
   <literallayout>
    country = ES
    organization = Mi Compa&ntilde;&iacute;a
    organizationalUnit = Contabilidad
    commonName = Pedro P&eacute;rez
   </literallayout>
   <para>
    De la misma manera que no hay reglas estrictas sobre como
    organizar la estructura de directorios de un disco duro, un
    administrador de un servidor de directorio puede establecer
    cualquier estructura que sea &uacute;til para sus
    prop&oacute;sitos. Sin embargo hay algunos acuerdos
    t&aacute;citos que siempre deben seguirse. La conclusi&oacute;n es que no
    se pueden escribir programas para acceder a un directorio si no
    se conoce algo de su estructura, igual que no se puede usar una
    base de datos sin alg&uacute;n conocimiento sobre lo que
    est&aacute; disponible en ella.
   </para>
   <para>
    Informaci&oacute;n sobre LDAP se puede encontrar en:
   </para>
   <itemizedlist>
    <listitem>
     <para>
      <ulink url="&url.ldap.netscape;">Mozilla</ulink>
     </para>
    </listitem>
    <listitem>
     <para>
      <ulink url="&url.ldap.openldap;">Proyecto OpenLDAP</ulink>
     </para>
    </listitem>
   </itemizedlist>
   
   <para>    
     Netscape SDK tiene una <ulink
     url="&url.ldap.netscape.sdk.docs;">Guia de
     programaci&oacute;n</ulink> muy buena en HTML.
   </para>
  </section>
  
  <section id="ldap.requirements">
   &reftitle.required;
   <para>
    Se necesita obtener y compilar las bibliotecas LDAP cliente de la
	direcci&oacute;n de <ulink url="&url.ldap.openldap.source;">OpenLDAP</ulink> 
	o de <ulink url="&url.ldap.bind9;">Bind9.net</ulink> para poder compilar 
	PHP con soporte LDAP.
   </para>
  </section>
  
  &reference.ldap.configure;
  
  &reference.ldap.ini;
  
  <section id="ldap.resources">
   &reftitle.resources;
   &no.resource;
  </section>

  &reference.ldap.constants;
  
  <section id="ldap-example">
   &reftitle.examples;
   <para>
    Recuperar informacion para todas las entradas donde el apellido
    empiece por "P" de un servidor de directorio, mostrando un
    listado con el nombre y direcci&oacute;n de correo
    electr&oacute;nico.
   </para>
   
   <example>
    <title>Ejemplo de b&uacute;squeda LDAP</title>
    <programlisting role="php">
<![CDATA[
<?php
// La secuencia básica para trabajar con LDAP es conectar, autentificarse,
// buscar, interpretar el resultado de la búsqueda y cerrar la conexión.

echo "<h3>Prueba de consulta LDAP</h3>";
echo "Conectando ...";
$ds=ldap_connect("localhost");  // Debe ser un servidor LDAP valido!
echo "El resultado de la conexion es ".$ds."<br />";

if ($ds) { 
    echo "Autentificandose  ..."; 
    $r=ldap_bind($ds);     // Autentificacion anonima, habitual de los
                           // accesos de solo lectura
    echo "El resultado de la autentificacion es ".$r."<br />";

    echo "Buscando (sn=P*) ...";
    // Busqueda de entradas por apellidos
    $sr=ldap_search($ds,"o=Mi Compania, c=ES", "sn=P*");  
    echo "El resultado de la busqueda es ".$sr."<br />";

    echo "El numero de entradas devueltas es ".ldap_count_entries($ds,$sr)."<br />";

    echo "Recuperando entradas ...<p>";
    $info = ldap_get_entries($ds, $sr);
    echo "Se han encontrado ".$info["count"]." entradas:<p>";

    for ($i=0; $i<$info["count"]; $i++) {
        echo "dn es: ". $info[$i]["dn"] ."<br />";
        echo "La primera entrada cn es: ". $info[$i]["cn"][0] ."<br />";
        echo "La primera entrada email es: ". $info[$i]["mail"][0] ."<br /><hr />";
    }

    echo "Cerrando conexion";
    ldap_close($ds);

} else {
    echo "<h4>No ha sido posible conectarse al servidor LDAP</h4>";
}
?>
]]>
    </programlisting>
   </example>
  </section>
  
  <section id="ldap.using">
   <title>Usando las funciones LDAP de PHP</title>
  
   <para>
    Antes de usar las funciones LDAP deben conocerse los siguientes datos...
    
    <itemizedlist>
     <listitem>
      <para>
       El nombre o direcci&oacute;n del servidor de directorio que se
       va a usar
      </para>
     </listitem>
     <listitem>
      <para>
       El "dn base" del servidor (la parte del directorio global
       que maneja ese servidor, que puede ser por ejemplo "o=Mi
       Compa&ntilde;&iacute;a,c=ES")
      </para>
     </listitem>
     <listitem>
      <para>
       Si es necesaria contrase&ntilde;a para acceder al servidor
       (muchos servidores ofrecen acceso de lectura para usuarios
       an&oacute;nimos pero requieren una contrase&ntilde;a para cualquier otro
       acceso)
      </para>
     </listitem>
    </itemizedlist>
   </para>
   
   <para>
    La secuencia t&iacute;pica de llamadas a funciones LDAP que realizan las 
aplicaciones suele seguir el siguiente patr&oacute;n:
    <literallayout>
  ldap_connect()    // establecer la conexi&oacute;n con el servidor
     |
  ldap_bind()       // acceso an&oacute;nimo o autentificado
     |
  Hacer b&uacute;squedas o actualizaciones en el directorio
  y mostrar los resultados
     |
  ldap_close()      // cerrar la conexi&oacute;n
    </literallayout>
   </para>
  </section>
 </partintro>
 
 &reference.ldap.functions;
 
 </reference>

<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-omittag:t
sgml-shorttag:t
sgml-minimize-attributes:nil
sgml-always-quote-attributes:t
sgml-indent-step:1
sgml-indent-data:t
indent-tabs-mode:nil
sgml-parent-document:nil
sgml-default-dtd-file:"../../../manual.ced"
sgml-exposed-tags:nil
sgml-local-catalogs:nil
sgml-local-ecat-files:nil
End:
vim600: syn=xml fen fdm=syntax fdl=2 si
vim: et tw=78 syn=sgml
vi: ts=1 sw=1
-->

