<?xml version="1.0" encoding="utf-8"?>
<!-- $Revision$ -->
<!-- EN-Revision: n/a Maintainer: lboshell Status: ready -->
<chapter xml:id="faq.build" xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">
  <title>Problemas de Compilación</title>
  <titleabbrev>Problemas de Compilación</titleabbrev>

   <para>
    Esta sección reúne la mayoría de errores que ocurren en tiempo de
    compilación.
   </para>

  <qandaset>
   <qandaentry xml:id="faq.build.configure">
    <question>
     <para>
      Tengo la última versión de PHP usando el servicio de CVS anónimo,
      ¡pero no hay un script configure!
     </para>
    </question>
    <answer>
     <para>
      Es necesario tener el paquete GNU autoconf instalado de modo que pueda
      generar el script configure desde <filename>configure.in</filename>.
      Simplemente ejecute <command>./buildconf</command> en el directorio
      superior después de obtener las fuentes del servidor CVS. (Asimismo, a
      menos que corra configure con la opción
      <literal>--enable-maintainer-mode</literal>, el script no será
      re-creado automáticamente cuando el archivo
      <filename>configure.in</filename> sea actualizado, así que debe
      asegurarse de hacerlo manualmente cuando note que configure.in ha
      cambiado. Un síntoma de esto es encontrar cosas como @VARIABLE@ en su
      Makefile después de que se ejecuta configure o
      <filename>config.status</filename>.)
     </para>
    </answer>
   </qandaentry>

   <qandaentry xml:id="faq.build.configuring">
    <question>
     <para>
      Tengo problemas configurando PHP para que funcione con Apache. Dice
      que no puede encontrar <filename>httpd.h</filename>, ¡pero está allí
      donde dije que estaba!
     </para>
    </question>
    <answer>
     <para>
      Necesita decirle al script configure/setup la ubicación del nivel
      superior de su árbol fuente de Apache. Esto quiere decir que debe
      especificar <option
      role="configure">--with-apache=/ruta/hacia/apache</option> y
      <emphasis>no</emphasis> <option
      role="configure">--with-apache=/ruta/hacia/apache/src</option>.
     </para>
    </answer>
   </qandaentry>

   <qandaentry xml:id="faq.build.lex">
    <question>
     <para>
      Mientras configuraba PHP (<literal>./configure</literal>), se
      encuentra con un error similar al siguiente:
     </para>
     <para>
      <screen>
       checking lex output file root... ./configure: lex: command not found
       configure: error: cannot find output from lex; giving up
      </screen>
     </para>
    </question>
    <answer>
     <para>
      Asegúrese de leer las instrucciones de <link
      linkend="install.unix">instalación</link> cuidadosamente y note que
      necesita instalar tanto flex como bison para compilar PHP. Dependiendo
      de su configuración, deberá instalar bison y flex ya sea desde el
      código fuente, o un paquete, como un RPM.
     </para>
    </answer>
   </qandaentry>

   <qandaentry xml:id="faq.build.apache-sharedcore">
    <question>
     <para>
      Cuando intento iniciar Apache, recibo el siguiente mensaje:
     </para>
     <para>
      <screen>
       fatal: relocation error: file /ruta/hacia/libphp4.so: symbol
       ap_block_alarms: referenced symbol not found
      </screen>
     </para>
    </question>
    <answer>
     <para>
      Este error aparece usualmente cuando se compila el programa núcleo de
      Apache como una biblioteca DSO para uso compartido. Intente
      reconfigurar apache, asegurándose de usar por lo menos las siguientes
      banderas:
     </para>
     <para>
      <screen>
      --enable-shared=max --enable-rule=SHARED_CORE
      </screen>
     </para>
     <para>
      Para más información, lea el archivo <filename>INSTALL</filename> en
      el nivel superior de Apache, o la <link
      xlink:href="&url.apachedso;">página del manual DSO</link> de Apache.
     </para>
    </answer>
   </qandaentry>

   <qandaentry xml:id="faq.build.not-found">
    <question>
     <para>
      Cuando ejecuto configure, ¡dice que no puede encontrar los archivos de
      inclusión o la biblioteca GD, gdbm o algún otro paquete!
     </para>
    </question>
    <answer>
     <para>
      Puede hacer que el script configura busque por archivos de cabecera y
      bibliotecas en ubicaciones no-estándar especificando banderas a pasar
      al pre-procesador y enlazador de C, como:
      <programlisting>
<![CDATA[
    CPPFLAGS=-I/ruta/hacia/include LDFLAGS=-L/ruta/hacia/biblioteca ./configure
]]>
      </programlisting>
      Si está usando una variante de csh como intérprete de comandos
      (¿porqué?), sería:
      <programlisting>
<![CDATA[
    env CPPFLAGS=-I/ruta/hacia/include LDFLAGS=-L/ruta/hacia/biblioteca ./configure
]]>
      </programlisting>
     </para>
    </answer>
   </qandaentry>

   <qandaentry xml:id="faq.build.yytname">
    <question>
     <para>
      Cuando está compilando el archivo
      <filename>language-parser.tab.c</filename>, produce errores diciendo
      <literal>yytname undeclared</literal>.
     </para>
    </question>
    <answer>
     <para>
      Necesita actualizar su versión de Bison. Puede encontrar la versión
      más reciente en <link xlink:href="&url.bison;">&url.bison;</link>.
     </para>
    </answer>
   </qandaentry>

   <qandaentry xml:id="faq.build.link">
    <question>
     <para>
      Cuando ejecuto <command>make</command>, parece correr bien pero luego
      falla cuando intenta enlazar la aplicación final, quejándose de que no
      puede encontrar algunos archivos.
     </para>
    </question>
    <answer>
     <para>
      Algunas versiones antiguas de make no colocan correctamente las
      versiones compiladas de los archivos en el directorio de funciones en
      ese mismo directorio. Intente ejecutar <command>cp *.o
      functions</command> y luego re-ejecute <command>make</command> para
      ver si eso ayuda. Si lo hace, realmente debería actualizarse a una
      versión reciente de GNU make.
     </para>
    </answer>
   </qandaentry>

   <qandaentry xml:id="faq.build.undefined">
    <question>
     <para>
      Cuando se enlaza PHP, se queja del número de referencias indefinidas.
     </para>
    </question>
    <answer>
     <para>
      Eche un vistazo a la línea de enlace y asegúrese de que todas las
      bibliotecas apropiadas están siendo incluidas al final. Algunas
      comunes que puede estar dejando pasar son '-ldl' y cualquier otra
      biblioteca requerida para el soporte de bases de datos que incluyó.
     </para>
     <para>
      Si está enlazando con Apache 1.2.x, ¿recordó agregar la información
      apropiada a la línea EXTRA_LIBS del archivo de configuración y
      re-ejecutó el script Configure de Apache? Vea el <link
      linkend="install">capítulo de instalación</link> para más información.
     </para>
     <para>
      Algunas personas han reportado también que han tenido que agregar
      '-ldl' inmediatamente después de <filename>libphp4.a</filename> cuando
      enlazan con Apache.
     </para>
    </answer>
   </qandaentry>

   <qandaentry xml:id="faq.build.Apache">
    <question>
     <para>
      No puedo lograr que compile PHP con Apache 1.3.
     </para>
    </question>
    <answer>
     <para>
      En realidad es sencillo. Siga los siguientes pasos cuidadosamente:
      <itemizedlist>
       <listitem>
        <simpara>
         Obtenga la última distribución de Apache 1.3 desde <link
         xlink:href="&url.apache.source;">&url.apache.source;</link>.
        </simpara>
       </listitem>
       <listitem>
        <simpara>
         Descomprima el archivo en alguna parte, por ejemplo
         <filename>/usr/local/src/apache-1.3</filename>.
        </simpara>
       </listitem>
       <listitem>
        <simpara>
         Compile PHP ejecutando en un principio <command>./configure
         --with-apache=/&lt;ruta&gt;/apache-1.3</command> (sustituya
         &lt;ruta&gt; con la ruta real a su directorio apache-1.3.)
        </simpara>
       </listitem>
       <listitem>
        <simpara>
         Escriba <command>make</command> seguido de <command>make
         install</command> para compilar PHP y copiar los archivos
         necesarios al árbol de la distribución de Apache.
        </simpara>
       </listitem>
       <listitem>
        <simpara>
         Cambie de directorios al directorio
         <filename>/&lt;ruta&gt;/apache-1.3/src</filename> y edite el
         archivo <filename>Configuration</filename>. Agregue al archivo:
         <literal>AddModule modules/php4/libphp4.a</literal>.
        </simpara>
       </listitem>
       <listitem>
        <simpara>
         Escriba: <command>./configure</command> seguido por
         <literal>make</literal>.
        </simpara>
       </listitem>
       <listitem>
        <simpara>
         ¡Ahora debe tener un binario httpd habilitado con PHP!
        </simpara>
       </listitem>
      </itemizedlist>
     </para>
     <para>
      <emphasis>Nota:</emphasis> También es posible usar el nuevo script
      <literal>./configure</literal> de Apache. Vea las instrucciones en el
      archivo <literal>README.configure</literal> que es parte de su
      distribución de Apache. También eche un vistazo al archivo
      <filename>INSTALL</filename> en la distribución de PHP.
     </para>
    </answer>
   </qandaentry>

   <qandaentry xml:id="faq.build.not-running">
    <question>
     <para>
      He seguido todos los pasos para instalar la versión tipo módulo de
      Apache en Unix, y mis scripts PHP aparecen en mi navegador o se me
      pide que guarde el archivo.
     </para>
    </question>
    <answer>
     <para>
      Esto quiere decir que el módulo PHP no está siendo invocado por alguna
      razón. Tres cosas que puede verificar antes de solicitar más ayuda:
      <itemizedlist>
       <listitem>
        <simpara>
         Asegúrese de que el binario httpd que está corriendo es el binario
         httpd real que acaba de compilar. Para hacer esto, pruebe ejecutar:
         <literal>/ruta/hacia/binario/httpd -l</literal>
        </simpara>
        <simpara>
         Si no ve <filename>mod_php4.c</filename> listado entonces no está
         ejecutando el binario correcto. Encuentre e instale el binario
         correcto.
        </simpara>
       </listitem>
       <listitem>
        <simpara>
         Asegúrese de que ha agregado el Tipo Mime correcto a uno de sus
         archivo <literal>.conf</literal> de Apache. Debe ser:
         <literal>AddType application/x-httpd-php .php</literal>
        </simpara>
        <simpara>
         También asegúrese de que esta línea AddType no está escondida al
         interior de un bloque &lt;Virtualhost&gt; o &lt;Directory&gt; que
         puede prevenir que se aplique en la ubicación de su script de
         prueba.
        </simpara>
       </listitem>
       <listitem>
        <simpara>
         Finalmente, la ubicación predeterminada de los archivos de
         configuración de Apache cambió entre Apache 1.2 y Apache 1.3.
         Debería verificar que el archivo de configuración al que le está
         agregando la línea AddType está siendo leído en realidad. Puede
         colocar un error de sintaxis obvio en su archivo &httpd.conf; o
         algún otro cambio obvio que le dirá si el archivo está siendo leído
         correctamente.
        </simpara>
       </listitem>
      </itemizedlist>
     </para>
    </answer>
   </qandaentry>

   <qandaentry xml:id="faq.build.activate-module">
    <question>
     <para>
      Dice que use:
      <literal>--activate-module=src/modules/php4/libphp4.a</literal>, pero
      ese archivo no existe, ¡así que lo cambié a
      <literal>--activate-module=src/modules/php4/libmodphp4.a</literal> y
      no funciona! ¿Qué está pasando?
     </para>
    </question>
    <answer>
     <para>
      Note que el archivo <filename>libphp4.a</filename> no se supone que
      exista. !El proceso de apache lo creará!
     </para>
    </answer>
   </qandaentry>

   <qandaentry xml:id="faq.build.ansi">
    <question>
     <para>
      Cuando intento compilar Apache con PHP como un módulo estático usando
      <literal>--activate-module=src/modules/php4/libphp4.a</literal> me
      dice que mi compilador no es compatible con ANSI.
     </para>
    </question>
    <answer>
     <para>
      Este es un mensaje de error equivocado de Apache que ha sido arreglado
      en versiones más recientes.
     </para>
    </answer>
   </qandaentry>

   <qandaentry xml:id="faq.build.apxs">
    <question>
     <para>
      Cuando intento compilar PHP usando <option
      role="configure">--with-apxs</option> obtengo mensajes de error
      extraños.
     </para>
    </question>
    <answer>
     <para>
      Hay tres cosas que pueden verificarse. Primero, por alguna razón
      cuando Apache compila el script Perl apxs, a veces termina
      compilándose sin las variables y banderas de compilación apropiadas.
      Encuentre su script apxs (pruebe con el comando <command>which
      apxs</command>), a veces se encuentra en
      <filename>/usr/local/apache/bin/apxs</filename> o
      <filename>/usr/sbin/apxs</filename>. Ábralo y verifique que tenga
      líneas similares a las siguientes:
      <programlisting>
<![CDATA[
my $CFG_CFLAGS_SHLIB  = ' ';          # substituted via Makefile.tmpl
my $CFG_LD_SHLIB      = ' ';          # substituted via Makefile.tmpl
my $CFG_LDFLAGS_SHLIB = ' ';          # substituted via Makefile.tmpl
]]>
      </programlisting>
      Si esto es lo que ve, ha encontrado su problema. Puede que contengan
      solo espacios u otros valores incorrectos, como 'q()'. Cambie estas
      líneas para que digan:
      <programlisting>
<![CDATA[
my $CFG_CFLAGS_SHLIB  = '-fpic -DSHARED_MODULE'; # substituted via Makefile.tmpl
my $CFG_LD_SHLIB      = 'gcc';                   # substituted via Makefile.tmpl
my $CFG_LDFLAGS_SHLIB = q(-shared);              # substituted via Makefile.tmpl 
]]>
      </programlisting>
      El segundo problema posible debería ocurrir únicamente en Red Hat 6.1
      y 6.2. El script apxs que distribuye Red Hat está mal. Busque esta
      línea:
      <programlisting>
<![CDATA[
my $CFG_LIBEXECDIR    = 'modules';         # substituted via APACI install
]]>
      </programlisting>
      Si ve esta línea, cámbiela por esto:
      <programlisting>
<![CDATA[
my $CFG_LIBEXECDIR    = '/usr/lib/apache'; # substituted via APACI install
]]>
      </programlisting>
      Por último, si usted re-configura/re-instala Apache, agregue un
      <command>make clean</command> al proceso después de
      <command>./configure</command> y antes de <command>make</command>.
     </para>
    </answer>
   </qandaentry>

   <qandaentry xml:id="faq.build.microtime">
    <question>
     <para>
      Durante <command>make</command>, recibo errores sobre microtime, y
      muchos sobre <literal>RUSAGE_</literal>.
     </para>
    </question>
    <answer>
     <para>
      Durante la porción <command>make</command> de la instalación, si
      encuentra problemas similares a esto:
      <programlisting>
<![CDATA[
microtime.c: In function `php_if_getrusage':
microtime.c:94: storage size of `usg' isn't known
microtime.c:97: `RUSAGE_SELF' undeclared (first use in this function)
microtime.c:97: (Each undeclared identifier is reported only once
microtime.c:97: for each function it appears in.)
microtime.c:103: `RUSAGE_CHILDREN' undeclared (first use in this function)
make[3]: *** [microtime.lo] Error 1
make[3]: Leaving directory `/home/master/php-4.0.1/ext/standard'
make[2]: *** [all-recursive] Error 1
make[2]: Leaving directory `/home/master/php-4.0.1/ext/standard'
make[1]: *** [all-recursive] Error 1
make[1]: Leaving directory `/home/master/php-4.0.1/ext'
make: *** [all-recursive] Error 1
]]>
      </programlisting>
     </para>
     <para>
      Su sistema está dañado. Necesita arreglar sus archivos
      <filename>/usr/include</filename> instalando un paquete glibc-devel
      que coincida con su glibc. Esto no tiene nada que ver con PHP. Para
      probar este punto, realice la siguiente prueba:
     <programlisting>
<![CDATA[
$ cat >test.c <<X
#include <sys/resource.h>
X
$ gcc -E test.c >/dev/null
]]>
      </programlisting>
      Si eso produce errores, sabrá que sus archivos de inclusión están en
      mal estado.
     </para>
    </answer>
   </qandaentry>

   <qandaentry xml:id="faq.build.mysql.tempnam">
    <question>
     <para>
      Cuando compilo PHP con MySQL, configure corre bien, pero durante
      <literal>make</literal> recibo un error similar al siguiente:
      <emphasis>ext/mysql/libmysql/my_tempnam.o(.text+0x46): In function
      my_tempnam': /php4/ext/mysql/libmysql/my_tempnam.c:103: the use of
      tempnam' is dangerous, better use mkstemp'</emphasis>, ¿qué está
      fallando?
     </para>
    </question>
    <answer>
     <para>
      Primero, es importante entender que esta es una
      <literal>Advertencia</literal> y no un error fatal. Dado que ésta es
      con frecuencia la última salida observada durante
      <literal>make</literal>, puede parecer como un error fatal, pero no lo
      es. Por supuesto, si ha configurado su compilador para que se detenga
      en las Advertencias, lo hará. También tenga en cuenta que el soporte
      MySQL está habilitado por defecto.
     </para>
     <note>
      <para>
       A partir de PHP 4.3.2, también verá el siguiente texto después de que
       la compilación (make) se complete:
      </para>
      <para>
       <screen>
        Build complete.
        (It is safe to ignore warnings about tempnam and tmpnam).
       </screen>
      </para>
     </note>
    </answer>
   </qandaentry>

   <qandaentry xml:id="faq.build.upgrade">
    <question>
     <para>
      Quiero actualizar mi instalación de PHP. ¿Dónde puedo encontrar la
      línea <command>./configure</command> que fue usada para compilar mi
      instalación actual de PHP?
     </para>
    </question>
    <answer>
     <para>
      Bien puede mirar su archivo config.nice, en el árbol actual de su
      instalación PHP actual o, si no está disponible, simplemente ejecute
      un script como el siguiente
      <programlisting role="php">
<![CDATA[
       <?php phpinfo(); ?>
]]>
      </programlisting>
      Al comienzo de la salida, la línea <command>./configure</command>
      usada para compilar la instalación PHP actual es desplegada.
     </para>
    </answer>
   </qandaentry>

   <qandaentry xml:id="faq.build.gdlibs">
    <question>
     <para>
      Cuando se compila PHP con la biblioteca GD se producen errores
      extraños de compilación o produce un fallo de segmentos (segfault) en
      la ejecución.
     </para>
    </question>
    <answer>
     <para>
      Asegúrese de que su biblioteca GD y PHP están enlazados contra las
      mismas bibliotecas de dependencia (p.ej. libpng).
     </para>
    </answer>
   </qandaentry>

   <qandaentry xml:id="faq.installation.needgnu">
    <question>
     <para>
      Cuando se compila PHP parece que recibo errores aleatorios, como si se
      colgara. Estoy usando Solaris si eso tiene importancia.
     </para>
    </question>
    <answer>
     <para>
      Usar utilidades no-GNU durante la compilación de PHP puede causar
      problemas. Asegúrese de usar herramientas GNU para tener la certeza de
      que la compilación de PHP funcione. Por ejemplo, en Solaris, usar las
      versiones de SunOS compatibles-con-BSD o de Solaris de
      <literal>sed</literal> no funcionará, pero usar las versiones GNU o
      Sun POSIX (xpg4) de <literal>sed</literal> lo hará. Enlaces: <link
      xlink:href="&url.sed;">GNU sed</link>, <link
      xlink:href="&url.flex;">GNU flex</link>, y <link
      xlink:href="&url.bison;">GNU bison</link>.
     </para>
    </answer>
   </qandaentry>
  </qandaset>
 </chapter>

<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-omittag:t
sgml-shorttag:t
sgml-minimize-attributes:nil
sgml-always-quote-attributes:t
sgml-indent-step:1
sgml-indent-data:t
indent-tabs-mode:nil
sgml-parent-document:nil
sgml-default-dtd-file:"../../manual.ced"
sgml-exposed-tags:nil
sgml-local-catalogs:nil
sgml-local-ecat-files:nil
End:
vim600: syn=xml fen fdm=syntax fdl=2 si
vim: et tw=78 syn=sgml
vi: ts=1 sw=1
-->
